<body>
Push F10 to start recording, and release key to stop recording.
</body>
<script>
  function initializePushToTalk(key) {
    const speechRecognition = new webkitSpeechRecognition();
    speechRecognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript;
      const speechEvent = new CustomEvent("speech", {
        detail: transcript,
      });
      document.dispatchEvent(speechEvent);
    };
    let isListening = false;

    document.addEventListener("keydown", (event) => {
      if (event.key === key) {
        if (!isListening) {
          speechRecognition.start();
          isListening = true;
          const speechEvent = new CustomEvent("speechstarted");
          document.dispatchEvent(speechEvent);
        }
      }
    });

    function finish() {
      setTimeout(() => {
        speechRecognition.stop();
        isListening = false;
        const speechEvent = new CustomEvent("speechended");
        document.dispatchEvent(speechEvent);
      }, 500);
    }

    window.addEventListener("blur", () => {
      if (isListening) {
        finish();
      }
    });

    document.addEventListener("keyup", (event) => {
      if (event.key === key && isListening) {
        finish();
      }
    });
  }

  initializePushToTalk("F10");

  document.addEventListener("speech", (event) => {
    const transcript = event.detail;
    const transcriptElement = document.createElement("p");
    transcriptElement.innerText = transcript;
    document.body.appendChild(transcriptElement);
  });

  document.addEventListener("speechstarted", () => {
    const statusElement = document.createElement("p");
    statusElement.innerText = "Listening...";
    document.body.appendChild(statusElement);
  });

  document.addEventListener("speechended", () => {
    const statusElement = document.createElement("p");
    statusElement.innerText = "Stopped listening.";
    document.body.appendChild(statusElement);
  });
</script>
